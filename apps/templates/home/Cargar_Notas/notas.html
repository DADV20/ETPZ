{% extends 'layouts/base.html' %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}
<link id="pagestyle_dark" href="{{ ASSETS_ROOT }}/css/table.css" rel="stylesheet" />
{% endblock stylesheets %}

{% block content %}
{% load tags %}
<div class="container-fluid py-4">

  <div class="row">
    <div class="col-12">
      <div class="card mb-4">
        <div class="card-header pb-0">
          <div class="d-flex justify-content-between"> 
            <h6>{{ title }}</h6>
            <div>
              <button class="btn btn-icon btn-3 btn-primary btn-sm" type="button" onclick="imprimirTabla()">
                <span class="btn-inner--icon"><i class="fas fa-print"></i></span>
                <span class="btn-inner--text">Imprimir</span>
              </button>
            </div>
            {% if url_crear %}
            <a href="{{ url_crear }}" title="Agregar {{ segment }}">
              <i class="fa fa-plus-circle" aria-hidden="true"></i>
            </a>
            {% endif %}
          </div>
        </div>
        <div class="card-body p-0 d-flex justify-content-center pb-5">
          <table id="tabla-notas" width="900">
            <tr>
              <th class="text-center" colspan="8"><img src="{{ ASSETS_ROOT }}/img/etpz.png" alt="Logo de la Institución"
                  width="120">
              </th>

              <th colspan="10" class="text-center">
                    REPÚBLICA BOLIVARIANA DE VENEZUELA <br>
                    MINISTERIO DEL PODER POPULAR PARA LA EDUCACIÓN <br>
                    ESCUELA TÉCNICA INDUSTRIAL PEDRO ZARAZA <br>
                    SAN JUAN DE LOS MORROS-EDO.GUÁRICO
              </th>
              <th colspan="4"></th>
            </tr>
            <tr>
                <th colspan="8"></th>
                <th colspan="10" class="text-center pt-3">
                    LISTADO DE CONSEJO DE CURSO
                </th>
                <th colspan="4"></th>
            </tr>
            <tr>
              <th height="10" colspan="22"></th>
            </tr>
            <tr>
              <th contenteditable="true" class="solid-1_text-center p-2" colspan="1">I</th>
              <th contenteditable="true" class="solid-1_text-center P-2" colspan="9">LAPSO AÑO: 1ERO SECCIÓN: "MM"</th>
              <th contenteditable="true" class="solid-1_text-center P-2" colspan="6">ESCOLARIDAD: 2023-2024</th>
              <th contenteditable="true" class="solid-1_text-center P-2" colspan="{{ col_span }}">PROF. GUÍA: MARÍA KELLYS</th>
          </tr>
          <tr>
            <td class="solid-1_text-center" colspan="12" rowspan="2">ASIGNATURAS</td>
            {% for materia in materias %}
            <td class="solid-1_text-center text-vertical p-2 uppercase" rowspan="2" width="50" height="150px">{{ materia.materia__nombre }}</td>
            {% endfor %}
            <td class="solid-1_text-center text-vertical p-2"  rowspan="2" colspan="2" width="50">PROMEDIO</td>
          </tr>
          <tr>
            <th height="10" colspan="22"></th>
          </tr>
          <tr>
            <th class="solid-1_text-center" colspan="1">Nro</th>
            <th class="solid-1_text-center" colspan="5" width="120">CÉDULA</th>
            <th class="solid-1_text-center" colspan="5" width="200">NOMBRES Y APELLIDOS</th>
            <td class="solid-1_text-center" colspan="1" width="50"></td>
            {% for i in materias %}
            <td class="solid-1_text-center" colspan="1" width="50">{{ forloop.counter }}</td>
            {% endfor %}
            <td class="solid-1_text-center" colspan="1" width="50"></td>
          </tr>

          {% comment %} Datos del estudiante comienza aqui {% endcomment %}

          {% for estudiante in estudiantes %}

          <tr>
            <th class="solid-1_text-center" colspan="1" rowspan="5">{{ forloop.counter }}</th>
            <td contenteditable="true" class="solid-1_text-center" colspan="5" rowspan="5">{{ estudiante.ci_tipo }}-{{ estudiante.ci }}</td>
            <td contenteditable="true" class="solid-1_text-center" colspan="5" rowspan="5">{{ estudiante.nombres }} {{ estudiante.apellidos }}</td>
            <th class="solid-1_text-center" colspan="1" rowspan="1">I Lapso</th>
            {% for i in materias %}
            <td contenteditable="true" class="solid-1_text-center" colspan="1" rowspan="1"></td>
            {% endfor %}
            <td contenteditable="true" class="solid-1_text-center" colspan="1" rowspan="1"></td>
          </tr>
          <tr>
            <th class="solid-1_text-center" colspan="1" rowspan="1">II Lapso</th>
            {% for i in materias %}
            <td contenteditable="true" class="solid-1_text-center" colspan="1" rowspan="1"></td>
            {% endfor %}
            <td contenteditable="true" class="solid-1_text-center" colspan="1" rowspan="1"></td>
          </tr>
          <tr>
            <th class="solid-1_text-center" colspan="1" rowspan="1">III Lapso</th>
            {% for i in materias %}
            <td contenteditable="true" class="solid-1_text-center" colspan="1" rowspan="1"></td>
            {% endfor %}
            <td contenteditable="true" class="solid-1_text-center" colspan="1" rowspan="1"></td>
          </tr>
          <tr class="bg-blue">
            <th class="solid-1_text-center" colspan="1" rowspan="1">Definitiva</th>
            {% for i in materias %}
            <td contenteditable="true" class="solid-1_text-center" colspan="1" rowspan="1"></td>
            {% endfor %}
            <td contenteditable="true" class="solid-1_text-center" colspan="1" rowspan="1"></td>
          </tr>
          <tr class="bg-red">
            <th class="solid-1_text-center c-red" colspan="1" rowspan="1">Revisión</th>
            {% for i in materias %}
            <td contenteditable="true" class="solid-1_text-center" colspan="1" rowspan="1"></td>
            {% endfor %}
            <td contenteditable="true" class="solid-1_text-center" colspan="1" rowspan="1"></td>
          </tr>

          {% endfor %}

          {% comment %} Datos del estudiante termina aqui {% endcomment %}

          </table>
        </div>
      </div>
    </div>
  </div>
  
</div>

{% endblock content %}

<!-- Specific JS goes HERE --> 
{% block javascripts %}
<script> 
  
  function imprimirTabla() {
      // Guardar el contenido original del cuerpo
      var cuerpoOriginal = document.body.innerHTML;

      // Obtener el contenido de la tabla
      var contenidoTabla = document.getElementById("tabla-notas").outerHTML;

      // Reemplazar el contenido del cuerpo por el contenido de la tabla
      document.body.innerHTML = contenidoTabla;

      // Imprimir el documento
      window.print();

      // Revertir los cambios en el cuerpo
      document.body.innerHTML = cuerpoOriginal;
  }

  $('#buscar').keyup(function() {
    var params = new URLSearchParams(window.location.search);
    var data = {};
    for (var pair of params.entries()) {
      data[pair[0]] = pair[1];
    }
    data['buscar'] = $('#buscar').val();
    $.ajax({
        url: "{% url segment %}",
        data: data,
        dataType: 'json',
        success: function(data) {
            $('#contenedor-tabla').html(data.table_html);
            //$('#contenedor-paginador').html(data.paginator_html);
        }
    });
  })
  /*
  $(document).on('click', '.paginador', function(e) {
    e.preventDefault();
    var page = $(this).attr('href').split('page=')[1];
    var params = new URLSearchParams(window.location.search);
    var data = {};
    for (var pair of params.entries()) {
        data[pair[0]] = pair[1];
    }
    data['page'] = page;
    $.ajax({
        url: "{% url segment %}",
        data: data,
        dataType: 'json',
        success: function(data) {
            $('#contenedor-tabla').html(data.table_html);
            //$('#contenedor-paginador').html(data.paginator_html);
        }
    });
  });*/
  
</script>
{% endblock javascripts %}